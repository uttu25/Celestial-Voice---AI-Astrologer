<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Celestial Voice Debugger</title>
    
    <style>
      /* Ensure the debug layer is always on top */
      #diagnostics {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        color: #00ff00;
        font-family: monospace;
        padding: 20px;
        z-index: 99999;
        overflow-y: auto;
        pointer-events: none; /* Let clicks pass through if hidden */
      }
      .log-line { margin-bottom: 5px; border-bottom: 1px solid #333; }
      .error { color: #ff4444; font-weight: bold; font-size: 1.2em; }
      .success { color: #44ff44; }
    </style>

    <script>
      // --- CRITICAL ERROR TRAPPING ---
      window.logToScreen = function(msg, type = 'info') {
        const el = document.getElementById('diagnostics-logs');
        if (el) {
          const div = document.createElement('div');
          div.className = 'log-line ' + type;
          div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
          el.appendChild(div);
        }
        console.log(msg);
      };

      window.onerror = function(msg, url, line, col, error) {
        window.logToScreen(`CRITICAL ERROR: ${msg}\nLine: ${line}`, 'error');
        // Keep the debug screen visible if there is an error
        document.getElementById('diagnostics').style.display = 'block';
      };

      window.addEventListener('unhandledrejection', function(event) {
        window.logToScreen(`PROMISE REJECTION: ${event.reason}`, 'error');
      });
    </script>
  </head>
  
  <body class="star-bg min-h-screen overflow-hidden">
    
    <div id="diagnostics">
      <h2 style="color:white; border-bottom: 2px solid white; padding-bottom: 10px;">
        ðŸš€ APP STATUS: <span id="app-status">INITIALIZING</span>
      </h2>
      <p>If you can read this, HTML loaded successfully.</p>
      <div id="diagnostics-logs"></div>
    </div>

    <div id="root"></div>

    <script>
      window.logToScreen("HTML Body Loaded.");
      window.logToScreen("Waiting for React (src/index.tsx)...");
      
      // Auto-hide debug layer if React loads successfully
      setTimeout(() => {
        const root = document.getElementById('root');
        if (root && root.childElementCount > 0) {
           window.logToScreen("React Mounted Successfully! Hiding debug layer...", 'success');
           document.getElementById('app-status').innerText = "RUNNING";
           document.getElementById('app-status').className = "success";
           
           // Hide after 2 seconds so you can see the success message
           setTimeout(() => {
             document.getElementById('diagnostics').style.opacity = '0';
             setTimeout(() => { document.getElementById('diagnostics').style.display = 'none'; }, 1000);
           }, 1500);
        } else {
           window.logToScreen("React took too long to mount. Check logs above.", 'error');
           document.getElementById('app-status').innerText = "STALLED";
           document.getElementById('app-status').style.color = "red";
        }
      }, 3000); // Wait 3 seconds for React
    </script>

    <script type="module" src="/src/index.tsx"></script>
  </body>
</html>
